services:
  collector:
    image: otel/opentelemetry-collector-contrib:0.116.1
    command: ["/otelcol-contrib", "--config=/etc/otelcol-contrib/config.yaml"]
    healthcheck:
      disable: false
    environment:
      K8S_NAMESPACE: ${SERVICE_NAMESPACE:-default}
      K8S_LOG_PATH: /var/log/pods/${SERVICE_NAMESPACE:-default}_*/*/*.log
    deploy:
      mode: global
    volumes:
      - ./${CONFIG:-a}/config.yaml:/etc/otelcol-contrib/config.yaml
      - pod-logs:/var/log/pods
    ports:
      - 4317
      - 4318

volumes:
  pod-logs:
    labels:
      kubepose.volume.hostPath: /var/log/pods
